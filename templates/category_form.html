{% extends "base.html" %}
{% block content %}

<h2 style="margin:0 0 10px 0;">{{ title }}</h2>
<p style="margin:0 0 18px 0;color:#9ca3af;">
  Provide the category name in <b>Arabic</b> and/or <b>English</b>. Arabic is the primary UX language, but English-only categories are allowed.
</p>

<form method="post" style="max-width:1100px;">
  <div class="midan-grid2">
    <div class="midan-field">
      <label class="midan-label">Category Name (AR)</label>
      <input class="midan-input" name="name_ar" id="cat_name_ar" value="{{ category.name_ar or '' }}" placeholder="Arabic name">
    </div>
    <div class="midan-field">
      <label class="midan-label">Category Name (EN)</label>
      <input class="midan-input" name="name_en" id="cat_name_en" value="{{ category.name_en or '' }}" placeholder="English name">
    </div>
  </div>

  <div class="midan-grid2 midan-rowgap">
    <div class="midan-field">
      <label class="midan-label">Description (AR)</label>
      <textarea class="midan-input" name="description_ar" rows="3" placeholder="Arabic description">{{ category.description_ar or '' }}</textarea>
    </div>
    <div class="midan-field">
      <label class="midan-label">Description (EN)</label>
      <textarea class="midan-input" name="description_en" rows="3" placeholder="English description">{{ category.description_en or '' }}</textarea>
    </div>
  </div>

  <div class="midan-field midan-rowgap">
    <label class="midan-label">Default Subtopic (optional)</label>
    <input class="midan-input" name="subtopic" id="cat_subtopic" list="cat_subtopic_suggestions"
           value="{{ category.subtopic or '' }}" placeholder="Optional seed subtopic">
    <datalist id="cat_subtopic_suggestions"></datalist>
    <div class="midan-help">
      This is a seed value only. Actual generation uses <b>Subtopic + Hint + Difficulty</b> on the question level.
    </div>
  </div>

  <button class="btn" type="submit">Save</button>
  <a class="muted" href="/categories" style="margin-left:10px;">Cancel</a>
</form>

<script>
(function(){
  async function suggest(){
    const en = (document.getElementById('cat_name_en')||{}).value || '';
    const ar = (document.getElementById('cat_name_ar')||{}).value || '';
    const dl = document.getElementById('cat_subtopic_suggestions');
    if(!dl) return;
    dl.innerHTML = '';
    const q = (en || ar).trim();
    if(!q) return;
    try{
      const r = await fetch('/api/subtopics/suggest?topic=' + encodeURIComponent(q));
      const data = await r.json();
      (data.items||[]).slice(0,12).forEach(t=>{
        const opt = document.createElement('option');
        opt.value = t;
        dl.appendChild(opt);
      });
    }catch(e){}
  }
  const enEl=document.getElementById('cat_name_en');
  const arEl=document.getElementById('cat_name_ar');
  if(enEl) enEl.addEventListener('blur', suggest);
  if(arEl) arEl.addEventListener('blur', suggest);
  // initial
  suggest();
})();
</script>

{% endblock %}
